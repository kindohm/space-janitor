(function(exports){var Settings=function(){};Settings.prototype={PLAYER_ROTATE_DELTA:5,PLAYER_THRUST_DELTA:.03,PLAYER_SIZE:30,PLAYER_LINE_WIDTH:1,BULLET_VELOCITY:5,BULLET_DELAY_TICKS:35,BULLET_SIZE_X:4,BULLET_SIZE_Y:4,THRUST_EFFECT_TICKS:8,THRUST_EFFECT_VEL:1};exports.Settings=Settings})(this);(function(exports){var cache=new Hashtable;var SpriteFactory=function(game){this.game=game};SpriteFactory.prototype={getBulletSprite:function(){if(!cache.containsKey(this.getBulletSprite)){var canvas=document.createElement("canvas");canvas.width=this.game.settings.BULLET_SIZE_X;canvas.height=this.game.settings.BULLET_SIZE_Y;var context=canvas.getContext("2d");context.fillStyle="#ccc";context.fillRect(0,0,this.game.settings.BULLET_SIZE_X,this.game.settings.BULLET_SIZE_Y);cache.put(this.getBulletSprite,canvas)}return cache.get(this.getBulletSprite)}};exports.SpriteFactory=SpriteFactory})(this);(function(exports){var Bullet=function(game,settings){var self=this;this.game=game;this.pos={x:settings.pos.x,y:settings.pos.y};this.vel={x:settings.vel.x,y:settings.vel.y};this.sprite=game.spriteFactory.getBulletSprite();this.size={x:this.game.settings.BULLET_SIZE_X,y:this.game.settings.BULLET_SIZE_Y}};Bullet.prototype={size:{x:2,y:2},halfSize:{x:1,y:1},update:function(){this.pos.x+=this.vel.x;this.pos.y+=this.vel.y;if(this.pos.y<=0||this.pos.y>=this.game.height||this.pos.x<=0||this.pos.x>=this.game.width){this.game.coquette.entities.destroy(this)}},draw:function(context){context.drawImage(this.sprite,this.pos.x,this.pos.y,this.size.x,this.size.y)}};exports.Bullet=Bullet})(this);(function(exports){var ThrustBubble=function(pos,direction){this.pos={x:pos.x,y:pos.y};this.vel={x:direction.x,y:direction.y}};ThrustBubble.prototype={radius:1,radiusGrowth:.2,ticksLeft:30,totalTicks:30,pos:null,colorBase:"204,204,204",update:function(){this.radius+=this.radiusGrowth;this.ticksLeft--;this.pos.x+=this.vel.x;this.pos.y+=this.vel.y},draw:function(context){var side=this.radius*2;context.beginPath();context.rect(this.pos.x-this.radius,this.pos.y-this.radius,side,side);context.closePath();context.lineWidth=1;var ratio=this.ticksLeft/this.totalTicks;context.strokeStyle="rgba("+this.colorBase+","+ratio.toString()+")";context.stroke()}};var ThrustEffect=function(game){this.effects=[];this.game=game};ThrustEffect.prototype={thrustEffectTicksLeft:0,add:function(pos,direction){var bubble=new ThrustBubble(pos,direction);this.effects.push(bubble)},update:function(player){this.thrustEffectTicksLeft=Math.max(0,this.thrustEffectTicksLeft-1);if(this.thrustEffectTicksLeft===0&&player.thrusting){var vector=this.game.maths.angleToVector(player.angle+180);var effectPos={x:player.pos.x+player.halfSize.x+vector.x*player.halfSize.x,y:player.pos.y+player.halfSize.y+vector.y*player.halfSize.y};var vel={x:vector.x*this.game.settings.THRUST_EFFECT_VEL,y:vector.y*this.game.settings.THRUST_EFFECT_VEL};this.add(effectPos,vel);this.thrustEffectTicksLeft=this.game.settings.THRUST_EFFECT_TICKS}for(var i=this.effects.length-1;i>=0;i--){if(this.effects[i].ticksLeft===0){this.effects.splice(i,1)}else{this.effects[i].update()}}},draw:function(context){for(var i=0;i<this.effects.length;i++){this.effects[i].draw(context)}}};exports.ThrustEffect=ThrustEffect})(this);(function(exports){var Bullet=exports.Bullet;function Player(game,settings){var self=this;this.pos={x:settings.pos.x,y:settings.pos.y};this.maxPos={x:settings.maxPos.x,y:settings.maxPos.y};this.game=game;this.size={x:game.settings.PLAYER_SIZE,y:game.settings.PLAYER_SIZE};this.halfSize={x:this.size.x/2,y:this.size.y/2};this.bulletTicksLeft=game.settings.BULLET_DELAY_TICKS;if(settings.ThrustEffect!=undefined){this.thrustEffect=new settings.ThrustEffect(game)}else{this.thrustEffect=new exports.ThrustEffect(game)}this.boundingBox=this.game.coquette.collider.CIRCLE}Player.prototype={colliding:false,thrustEffect:null,size:{x:20,y:30},halfSize:{x:10,y:15},vel:{x:0,y:0},angle:180,rAngle:3.14,angleVector:{x:0,y:0},thrust:{x:0,y:0},thrusting:false,thrustScale:0,shotTicksLeft:0,update:function(){this.handleKeyboard();this.vel.x+=this.thrust.x;this.vel.y+=this.thrust.y;this.pos.x+=this.vel.x;this.pos.y+=this.vel.y;this.wrap();this.shotTicksLeft=Math.max(0,this.shotTicksLeft-1);this.thrustEffect.update(this)},wrap:function(){if(this.pos.y>this.maxPos.y){this.pos.y=-this.size.y}else if(this.pos.y<-this.size.y){this.pos.y=this.maxPos.y}if(this.pos.x>this.maxPos.x){this.pos.x=-this.size.x}else if(this.pos.x<-this.size.x){this.pos.x=this.maxPos.x}},draw:function(context){context.save();context.translate(this.pos.x+this.halfSize.x,this.pos.y+this.halfSize.y);context.rotate(this.rAngle);context.beginPath();context.moveTo(-this.halfSize.x,-this.halfSize.y);context.lineTo(0,this.halfSize.y);context.lineTo(this.halfSize.x,-this.halfSize.y);context.lineTo(0,-this.halfSize.y/2);context.lineTo(-this.halfSize.x,-this.halfSize.y);context.closePath();context.strokeStyle="#ccc";context.lineWidth=this.game.settings.PLAYER_LINE_WIDTH;context.stroke();context.rotate(-this.Angle);context.translate(-this.pos.x,-this.pos.y);context.restore();this.thrustEffect.draw(context)},handleKeyboard:function(){if(this.game.coquette.inputter.state(this.game.coquette.inputter.UP_ARROW)){this.applyThrust()}else if(this.thrusting){this.idleThrust()}if(this.game.coquette.inputter.state(this.game.coquette.inputter.LEFT_ARROW)){this.rotate("left")}if(this.game.coquette.inputter.state(this.game.coquette.inputter.RIGHT_ARROW)){this.rotate("right")}if(this.game.coquette.inputter.state(this.game.coquette.inputter.SPACE)){this.shoot()}},rotate:function(direction){var delta=this.game.settings.PLAYER_ROTATE_DELTA;this.angle=this.game.maths.dial(this.angle,direction==="right"?delta:-delta,359);this.rAngle=this.game.maths.degToRad(this.angle)},applyThrust:function(){this.thrustScale=this.game.settings.PLAYER_THRUST_DELTA;var vector=this.game.maths.angleToVector(this.angle);this.thrust.x=vector.x*this.thrustScale;this.thrust.y=vector.y*this.thrustScale;this.thrusting=true},idleThrust:function(){this.thrust.x=this.thrust.y=this.thrustScale=0;this.thrusting=false},shoot:function(){if(this.shotTicksLeft===0){var vector=this.game.maths.angleToVector(this.angle);var bulletPos={x:vector.x*this.halfSize.x+this.halfSize.x+this.pos.x,y:vector.y*this.halfSize.y+this.halfSize.y+this.pos.y};var bulletVel={x:vector.x*this.game.settings.BULLET_VELOCITY,y:vector.y*this.game.settings.BULLET_VELOCITY};this.game.coquette.entities.create(Bullet,{pos:{x:bulletPos.x,y:bulletPos.y},vel:bulletVel});this.shotTicksLeft=this.game.settings.BULLET_DELAY_TICKS}},collision:function(other,type){if(type===this.game.coquette.collider.INITIAL){this.colliding=true}},uncollision:function(){this.colliding=false}};exports.Player=Player})(this);(function(exports){var Game=function(canvasId,width,height){this.coquette=new Coquette(this,canvasId,width,height,"#000");this.maths=new Maths;this.width=width;this.height=height;this.settings=new Settings;this.spriteFactory=new SpriteFactory(this)};Game.prototype={player:null,width:0,height:0,showBoundingBoxes:false,init:function(){var self=this;this.coquette.entities.create(Player,{pos:{x:this.width/2,y:this.height/2},maxPos:{x:this.width,y:this.height}},function(player){self.player=player})},update:function(){this.handleKeyboard()},draw:function(context){if(this.showBoundingBoxes){var entities=this.coquette.entities.all();for(var i=0;i<entities.length;i++){var entity=entities[i];context.beginPath();if(entity.boundingBox==this.coquette.collider.RECTANGLE){context.rect(entity.pos.x,entity.pos.y,entity.size.x,entity.size.y)}else{context.arc(entity.pos.x+entity.size.x/2,entity.pos.y+entity.size.y/2,entity.size.x/2,0,Math.PI*2,false)}context.lineWidth=entity.colliding?3:2;context.strokeStyle=entity.colliding?"#00ff00":"#FF006E";context.stroke()}}},handleKeyboard:function(){if(this.coquette.inputter.state(this.coquette.inputter.LEFT_ARROW)&&this.coquette.inputter.state(this.coquette.inputter.RIGHT_ARROW)){this.showBoundingBoxes=!this.showBoundingBoxes}}};exports.Game=Game})(this);